variables:
   IMAGE_TAG: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG

stages:
    - build
    - deploy

# build:
#     stage: build
#     image: docker:26.1.3
#     services:
#     - docker:dind
#     tags:
#       - docker
#     script:
#       - echo $CI_REGISTRY_USER
#       - echo $CI_REGISTRY_PASSWORD
#       - echo $CI_REGISTRY
#       - echo $IMAGE_TAG
#       - echo "$CA_CERTIFICATE"
#       - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
#       - docker build -t $IMAGE_TAG .      
#       - docker push $IMAGE_TAG

deploy:
  stage: deploy
  tags:
  - docker
  image: 
    name: bitnami/kubectl:latest
    entrypoint: ['']
  script:
    - echo "wtf?"
    - echo $CI_DEPLOY_PASSWORD
    - echo $CI_REGISTRY
    - echo $CI_DEPLOY_USER
#    - echo "$CI_DEPLOY_PASSWORD" | docker login $CI_REGISTRY -u $CI_DEPLOY_USER --password-stdin
    - kubectl config get-contexts
    - kubectl config use-context root/project1:a1-kuber
    - kubectl apply -f deployment.yml



#############
###